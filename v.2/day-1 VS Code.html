<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>CYB-ä»¿VS Code IDE(Web)</title>
    <link rel="icon" href="https://i-1.92sucai.com/2023/7/14/5541b41c-d8b8-465a-8edd-db5c2cef1a94.png">
    <style>
        body { 
            margin: 0;
            background: #1e1e1e;
            height: 100vh;
            display: flex;
            font-family: 'Segoe UI', sans-serif;
        }
        #container { flex:1; display: flex; flex-direction: column }
        #editor { height:80vh; border:1px solid #333 }
        .toolbar { padding:10px; background:#252526; display:flex; gap:8px }
        button { background:#0e639c; color:white; border:none; padding:6px 12px; cursor:pointer }
        input[type="file"] { display:none }
        /* é…ç½®å¼¹çª—æ ·å¼ */
        #configModal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #252526;
            padding: 20px;
            border: 1px solid #333;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div id="container">
        <div class="toolbar">
            <button onclick="document.getElementById('fileInput').click()">ğŸ“ æ‰“å¼€æ–‡ä»¶</button>
            <button onclick="formatCode()">âœ¨ æ ¼å¼åŒ–</button>
            <button onclick="fileHandler.saveFile()">ğŸ’¾ ä¿å­˜</button>
            <button onclick="showConfig()">âš™ï¸ æ¤å…¥è®¾ç½®</button>
            <a href="day1 VS Code-she-ji-chu-zhong-Dome.html" target="_blank">è®¾è®¡åˆè¡·</a>
            <a href="day-1 VS Code-Dome.html" target="_blank">å£°æ˜</a>
            <input type="file" id="fileInput" accept=".html,.js,.css,.json,.py,.java,.php">
        </div>
        <div id="editor"></div>
    </div>

    <!-- é…ç½®å¼¹çª— -->
    <div id="configModal">
        <h3 style="color:white; margin-top:0">è‡ªå®šä¹‰å£°æ˜è®¾ç½®</h3>
        <textarea id="headerContent" 
                  style="width:300px; height:100px; background:#1e1e1e; color:white; padding:8px"
                  placeholder="è¾“å…¥è¦æ¤å…¥çš„å†…å®¹ï¼ˆå¯ç”¨å˜é‡ï¼š\n{{date}} - å½“å‰æ—¶é—´\n{{filename}} - æ–‡ä»¶åï¼‰"></textarea>
        <div style="margin-top:15px; display:flex; gap:8px">
            <button onclick="saveConfig()">ä¿å­˜</button>
            <button onclick="hideConfig()" style="background:#666">å–æ¶ˆ</button>
        </div>
    </div>

    <!-- Monaco Editor åŠ è½½ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.36.1/min/vs/loader.min.js"></script>
    <script>
        // åˆå§‹åŒ–ç¼–è¾‘å™¨
        let editor;
        require.config({ paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.36.1/min/vs' }});
        require(['vs/editor/editor.main'], function() {
            editor = monaco.editor.create(document.getElementById('editor'), {
                value: '// è¾“å…¥æˆ–æ‰“å¼€æ–‡ä»¶å¼€å§‹ç¼–è¾‘(è¿™æ˜¯JavaScript,ç¼–è¾‘å…¶ä»–è¯·å¯¼å…¥æ–‡ä»¶)\n// è¯·å‹¿åˆ·æ–°,åæœè‡ªè´Ÿ!\n//--------------\n// ä½œè€…:CYB\n// æœªç»å…è®¸,ç¦æ­¢å•†ç”¨\n// GitHubåœ°å€:https://github.com/CYB140705/CYB-Web-VS-Code\n//--------------\n//                                                                     Here Your Code...',
                language: 'javascript',
                theme: 'vs-dark',
                automaticLayout: true,
                minimap: { enabled: true },
                scrollBeyondLastLine: false
            });
        });

        // æ–‡ä»¶æ“ä½œæ¨¡å—
        const fileHandler = {
            readFile(input) {
                const file = input.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = e => {
                    editor.setValue(e.target.result);
                    monaco.editor.setModelLanguage(editor.getModel(), this.detectLanguage(file.name));
                };
                reader.readAsText(file);
            },

            detectLanguage(filename) {
                const ext = filename.split('.').pop();
                const langMap = {
                    js: 'javascript',
                    html: 'html',
                    css: 'css',
                    py: 'python',
                    java: 'java',
                    php: 'php'
                };
                return langMap[ext] || 'plaintext';
            },

            saveFile() {
                const content = this.generateContent();
                const blob = new Blob([content], {type: 'text/plain'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = this.generateFilename();
                a.click();
                URL.revokeObjectURL(url);
            },

            generateContent() {
                const template = implantConfig.header
                    .replace(/{{date}}/g, new Date().toLocaleString())
                    .replace(/{{filename}}/g, this.generateFilename());
                return template + editor.getValue();
            },

            generateFilename() {
                return `CYB-VS Code IDE_${new Date().toISOString().slice(0,10)}_${Math.random().toString(36).slice(2, 7)}.html`;
            }
        };

        // é…ç½®æ¨¡å—
        let implantConfig = {
            header: `// {{date}}\n// æ­¤æ–‡ä»¶ç”± CYB-VS Code IDE ç”Ÿæˆ\n// ç‰ˆæƒæ‰€æœ‰ï¼Œç¦æ­¢éæ³•å•†ç”¨\n\n`
        };

        // åˆå§‹åŒ–é…ç½®
        (function initConfig() {
            const savedConfig = localStorage.getItem('implantConfig');
            if (savedConfig) implantConfig = JSON.parse(savedConfig);
        })();

        // é…ç½®ç›¸å…³å‡½æ•°
        function showConfig() {
            document.getElementById('headerContent').value = implantConfig.header;
            document.getElementById('configModal').style.display = 'block';
        }

        function hideConfig() {
            document.getElementById('configModal').style.display = 'none';
        }

        function saveConfig() {
            implantConfig.header = document.getElementById('headerContent').value;
            localStorage.setItem('implantConfig', JSON.stringify(implantConfig));
            hideConfig();
        }

        // äº‹ä»¶ç›‘å¬
        document.getElementById('fileInput').addEventListener('change', function() {
            fileHandler.readFile(this);
        });

        // æ ¼å¼åŒ–ä»£ç 
        function formatCode() {
            editor.getAction('editor.action.formatDocument').run();
        }
    </script>
</body>
</html>